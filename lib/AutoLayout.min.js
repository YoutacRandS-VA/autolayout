!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@lume/kiwi")):"function"==typeof define&&define.amd?define(["exports","@lume/kiwi"],e):e((t=t||self).AutoLayout={},t.kiwi)}(this,function(t,o){"use strict";var e,H={CONST:"const",NOTANATTRIBUTE:"const",VARIABLE:"var",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",WIDTH:"width",HEIGHT:"height",CENTERX:"centerX",CENTERY:"centerY",ZINDEX:"zIndex"},O={LEQ:"leq",EQU:"equ",GEQ:"geq"},r={REQUIRED:1e3,DEFAULTHIGH:750,DEFAULTLOW:250},s=(e=Vt,f=Error,i.prototype=f.prototype,e.prototype=new i,{SyntaxError:Vt,parse:function(u){function L(t,e,r){return Tt({relation:"equ"},t||{},e,r?r[1]:{})}function k(t){return{constant:t}}function Z(t,e){return{view:t+e}}var t=1<arguments.length?arguments[1]:{},l={},e={visualFormatString:m},r=m,c=l,h=null,q=":",D={type:"literal",value:":",description:'":"'},z=function(t,e,r,i,n){return{orientation:t?t[0]:"horizontal",cascade:(e||[]).concat([r],[].concat.apply([],i),n||[])}},G="H",X={type:"literal",value:"H",description:'"H"'},W="V",P={type:"literal",value:"V",description:'"V"'},U=function(t){return"H"==t?"horizontal":"vertical"},Q="|",B={type:"literal",value:"|",description:'"|"'},$=function(){return{view:null}},j="[",M={type:"literal",value:"[",description:'"["'},Y="]",J={type:"literal",value:"]",description:'"]"'},K=function(t,e){return Tt(t,e?{constraints:e}:{})},n="-",a={type:"literal",value:"-",description:'"-"'},tt=function(t){return t},et=function(){return[{relation:"equ",constant:"default",$parserOffset:C}]},rt="",it=function(){return[{relation:"equ",constant:0,$parserOffset:C}]},nt=function(t){return[{relation:"equ",constant:t,$parserOffset:C}]},at="(",st={type:"literal",value:"(",description:'"("'},o=",",p={type:"literal",value:",",description:'","'},ot=")",ut={type:"literal",value:")",description:'")"'},lt=function(t,e){return[t].concat(e.map(function(t){return t[1]}))},ct="@",ht={type:"literal",value:"@",description:'"@"'},s="==",pt={type:"literal",value:"==",description:'"=="'},ft=function(){return{relation:"equ",$parserOffset:C}},f="<=",dt={type:"literal",value:"<=",description:'"<="'},vt=function(){return{relation:"leq",$parserOffset:C}},d=">=",gt={type:"literal",value:">=",description:'">="'},At=function(){return{relation:"geq",$parserOffset:C}},v=/^[0-9]/,g={type:"class",value:"[0-9]",description:"[0-9]"},wt=function(t){return{priority:parseInt(t.join(""),10)}},A=/^[a-zA-Z_]/,w={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},_=/^[a-zA-Z0-9_]/,y={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},_t=".",yt={type:"literal",value:".",description:'"."'},bt=function(t,e){return parseFloat(t.concat(".").concat(e).join(""),10)},Ct=function(t){return parseInt(t.join(""),10)},b=0,C=0,E=0,I={line:1,column:1,seenCR:!1},i=0,T=[];if("startRule"in t){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=e[t.startRule]}function Et(t){if(E!==t){t<E&&(E=0,I={line:1,column:1,seenCR:!1});for(var e,r=I,i=t,n=E;n<i;n++)"\n"===(e=u.charAt(n))?(r.seenCR||r.line++,r.column=1,r.seenCR=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(r.line++,r.column=1,r.seenCR=!0):(r.column++,r.seenCR=!1);E=t}return I}function V(t){b<i||(i<b&&(i=b,T=[]),T.push(t))}function It(t,e,r){var i=Et(r),n=r<u.length?u.charAt(r):null;if(null!==e){var a=e,s=1;for(a.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});s<a.length;)a[s-1]===a[s]?a.splice(s,1):s++}return new Vt(null!==t?t:function(t,e){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=t[i].description;function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}return"Expected "+(1<t.length?r.slice(0,-1).join(", ")+" or "+r[t.length-1]:r[0])+" but "+(e?'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+n(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+n(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+n(t)})+'"':"end of input")+" found."}(e,n),e,n,r,i.line,i.column)}function m(){var t,e,r,i,n,a=b,s=b,o=function(){var t,e;t=b,72===u.charCodeAt(b)?(e=G,b++):(e=l,V(X));e===l&&(86===u.charCodeAt(b)?(e=W,b++):(e=l,V(P)));e!==l&&(C=t,e=U(e));return t=e}();if((s=(s=o!==l&&(58===u.charCodeAt(b)?(t=q,b++):(t=l,V(D)),t!==l)?o=[o,t]:(b=s,c))===l?h:s)!==l)if(o=b,(o=(o=(t=H())!==l&&(e=x())!==l?t=[t,e]:(b=o,c))===l?h:o)!==l)if((t=O())!==l){for(e=[],r=b,r=(i=x())!==l&&(n=O())!==l?i=[i,n]:(b=r,c);r!==l;)e.push(r),r=b,r=(i=x())!==l&&(n=O())!==l?i=[i,n]:(b=r,c);a=e!==l&&(r=b,(r=(r=(i=x())!==l&&(n=H())!==l?i=[i,n]:(b=r,c))===l?h:r)!==l)?(C=a,s=z(s,o,t,e,r)):(b=a,c)}else b=a,a=c;else b=a,a=c;else b=a,a=c;return a}function H(){var t,e=b;return 124===u.charCodeAt(b)?(t=Q,b++):(t=l,V(B)),t!==l&&(C=e,t=$()),t}function O(){var t,e,r,i,n=b;return 91===u.charCodeAt(b)?(t=j,b++):(t=l,V(M)),n=t!==l&&(e=F())!==l&&(r=(r=S())===l?h:r)!==l&&(93===u.charCodeAt(b)?(i=Y,b++):(i=l,V(J)),i!==l)?(C=n,t=K(e,r)):(b=n,c)}function x(){var t,e,r,i=b;return 45===u.charCodeAt(b)?(t=n,b++):(t=l,V(a)),(i=t!==l&&(e=function(){var t;(t=function(){var t,e;t=b,(e=N())!==l&&(C=t,e=nt(e));return t=e}())===l&&(t=S());return t}())!==l&&(45===u.charCodeAt(b)?(r=n,b++):(r=l,V(a)),r!==l)?(C=i,t=tt(e)):(b=i,c))===l&&(i=b,45===u.charCodeAt(b)?(t=n,b++):(t=l,V(a)),t!==l&&(C=i,t=et()),(i=t)===l)&&(i=b,(t=rt)!==l&&(C=i,t=it()),i=t),i}function S(){var t,e,r,i,n,a,s=b;if(40===u.charCodeAt(b)?(t=at,b++):(t=l,V(st)),t!==l)if((e=R())!==l){for(r=[],i=b,44===u.charCodeAt(b)?(n=o,b++):(n=l,V(p)),i=n!==l&&(a=R())!==l?n=[n,a]:(b=i,c);i!==l;)r.push(i),i=b,44===u.charCodeAt(b)?(n=o,b++):(n=l,V(p)),i=n!==l&&(a=R())!==l?n=[n,a]:(b=i,c);s=r!==l&&(41===u.charCodeAt(b)?(i=ot,b++):(i=l,V(ut)),i!==l)?(C=s,t=lt(e,r)):(b=s,c)}else b=s,s=c;else b=s,s=c;return s}function R(){var t,e,r,i,n=b,a=function(){var t,e;t=b,u.substr(b,2)===s?(e=s,b+=2):(e=l,V(pt));e!==l&&(C=t,e=ft());(t=e)===l&&(t=b,u.substr(b,2)===f?(e=f,b+=2):(e=l,V(dt)),e!==l&&(C=t,e=vt()),(t=e)===l)&&(t=b,u.substr(b,2)===d?(e=d,b+=2):(e=l,V(gt)),e!==l&&(C=t,e=At()),t=e);return t}();return n=(a=a===l?h:a)!==l&&(t=function(){var t;(t=function(){var t,e;t=b,(e=N())!==l&&(C=t,e=k(e));return t=e}())===l&&(t=F());return t}())!==l&&(e=b,64===u.charCodeAt(b)?(r=ct,b++):(r=l,V(ht)),(e=(e=r!==l&&(i=function(){var t,e,r;t=b,e=[],v.test(u.charAt(b))?(r=u.charAt(b),b++):(r=l,V(g));if(r!==l)for(;r!==l;)e.push(r),v.test(u.charAt(b))?(r=u.charAt(b),b++):(r=l,V(g));else e=c;e!==l&&(C=t,e=wt(e));return t=e}())!==l?r=[r,i]:(b=e,c))===l?h:e)!==l)?(C=n,a=L(a,t,e)):(b=n,c)}function F(){var t,e,r=b,i=b,n=[];if(A.test(u.charAt(b))?(t=u.charAt(b),b++):(t=l,V(w)),t!==l)for(;t!==l;)n.push(t),A.test(u.charAt(b))?(t=u.charAt(b),b++):(t=l,V(w));else n=c;if((i=n=n!==l?u.substring(i,b):n)!==l){for(n=b,t=[],_.test(u.charAt(b))?(e=u.charAt(b),b++):(e=l,V(y));e!==l;)t.push(e),_.test(u.charAt(b))?(e=u.charAt(b),b++):(e=l,V(y));r=(n=t=t!==l?u.substring(n,b):t)!==l?(C=r,i=Z(i,n)):(b=r,c)}else b=r,r=c;return r}function N(){var t,e,r,i=b,n=[];if(v.test(u.charAt(b))?(t=u.charAt(b),b++):(t=l,V(g)),t!==l)for(;t!==l;)n.push(t),v.test(u.charAt(b))?(t=u.charAt(b),b++):(t=l,V(g));else n=c;if(n!==l)if(46===u.charCodeAt(b)?(t=_t,b++):(t=l,V(yt)),t!==l){if(e=[],v.test(u.charAt(b))?(r=u.charAt(b),b++):(r=l,V(g)),r!==l)for(;r!==l;)e.push(r),v.test(u.charAt(b))?(r=u.charAt(b),b++):(r=l,V(g));else e=c;i=e!==l?(C=i,n=bt(n,e)):(b=i,c)}else b=i,i=c;else b=i,i=c;if(i===l){if(i=b,n=[],v.test(u.charAt(b))?(t=u.charAt(b),b++):(t=l,V(g)),t!==l)for(;t!==l;)n.push(t),v.test(u.charAt(b))?(t=u.charAt(b),b++):(t=l,V(g));else n=c;n!==l&&(C=i,n=Ct(n)),i=n}return i}function Tt(t){for(var e=1;e<arguments.length;e++)for(var r in arguments[e])t[r]=arguments[e][r];return t}if((e=r())!==l&&b===u.length)return e;throw e!==l&&b<u.length&&V({type:"end",description:"end of input"}),It(null,T,i)}});function Vt(t,e,r,i,n,a){this.message=t,this.expected=e,this.found=r,this.offset=i,this.line=n,this.column=a,this.name="SyntaxError"}function i(){this.constructor=e}n=ar,f=Error,a.prototype=f.prototype,n.prototype=new a;var n,u={SyntaxError:ar,parse:function(u){function k(t,e){return{attr:t,predicates:e}}function Z(){return"horzvert"}function q(){return"horizontal"}function D(){return"vertical"}function z(){return"zIndex"}function G(){return{view:null}}function X(t,e){return e.length?[t].concat([].concat.apply([],e)):t}function W(t,e){return[].concat([].concat.apply([],t),[e])}function P(t,e,r){return L({relation:"equ"},t||{},e,r?r[1]:{})}function U(t){return{constant:t}}function Q(t){return{constant:-t}}function B(t){return{view:null,multiplier:t/100}}function $(t){return{view:null,multiplier:t/-100}}function j(t,e,r,i){return{view:t.view,attribute:e||void 0,multiplier:r||1,constant:i||void 0}}function M(t,e,r){return{view:t+e,range:r,$parserOffset:V}}var t=1<arguments.length?arguments[1]:{},l={},e={visualFormatStringExt:Be},Y=Be,c=l,J="C:",K={type:"literal",value:"C:",description:'"C:"'},h=null,tt=function(t,e,r,i){return{type:"attribute",view:t.view,attributes:[e].concat(r)}},et=":",rt={type:"literal",value:":",description:'":"'},it=function(t,e,r,i,n,a){return{type:"vfl",orientation:t?t[0]:"horizontal",cascade:(e||[]).concat(r,[].concat.apply([],i),n||[])}},nt="HV",at={type:"literal",value:"HV",description:'"HV"'},st="H",ot={type:"literal",value:"H",description:'"H"'},ut="V",lt={type:"literal",value:"V",description:'"V"'},ct="Z",ht={type:"literal",value:"Z",description:'"Z"'},pt=" ",ft={type:"literal",value:" ",description:'" "'},dt="//",vt={type:"literal",value:"//",description:'"//"'},gt={type:"any",description:"any character"},At="|",wt={type:"literal",value:"|",description:'"|"'},_t="[",yt={type:"literal",value:"[",description:'"["'},o=",",p={type:"literal",value:",",description:'","'},bt="]",Ct={type:"literal",value:"]",description:'"]"'},Et=function(t,e,r){return L(L(t,e?{constraints:e}:{}),r?{cascade:r}:{})},It="->",Tt={type:"literal",value:"->",description:'"->"'},Vt=function(){return[{relation:"none"}]},a="-",s={type:"literal",value:"-",description:'"-"'},mt=function(t){return t},Ht=function(){return[{relation:"equ",constant:"default"}]},n="~",f={type:"literal",value:"~",description:'"~"'},Ot=function(){return[{relation:"equ",equalSpacing:!0}]},xt="",St=function(){return[{relation:"equ",constant:0}]},Rt=function(t){return[{relation:"equ",multiplier:t.multiplier}]},Ft=function(t){return[{relation:"equ",constant:t}]},Nt="(",Lt={type:"literal",value:"(",description:'"("'},kt=")",Zt={type:"literal",value:")",description:'")"'},qt=function(t,e){return[t].concat(e.map(function(t){return t[1]}))},Dt="@",zt={type:"literal",value:"@",description:'"@"'},Gt=function(t,e,r){return L({relation:"equ",equalSpacing:!0},t||{},e,r?r[1]:{})},Xt="==",Wt={type:"literal",value:"==",description:'"=="'},Pt=function(){return{relation:"equ"}},Ut="<=",Qt={type:"literal",value:"<=",description:'"<="'},Bt=function(){return{relation:"leq"}},$t=">=",jt={type:"literal",value:">=",description:'">="'},Mt=function(){return{relation:"geq"}},d=/^[0-9]/,v={type:"class",value:"[0-9]",description:"[0-9]"},Yt=function(t){return{priority:parseInt(t.join(""),10)}},g="+",A={type:"literal",value:"+",description:'"+"'},w="%",_={type:"literal",value:"%",description:'"%"'},Jt=".left",Kt={type:"literal",value:".left",description:'".left"'},te=function(){return"left"},ee=".right",re={type:"literal",value:".right",description:'".right"'},ie=function(){return"right"},ne=".top",ae={type:"literal",value:".top",description:'".top"'},se=function(){return"top"},oe=".bottom",ue={type:"literal",value:".bottom",description:'".bottom"'},le=function(){return"bottom"},ce=".width",he={type:"literal",value:".width",description:'".width"'},pe=function(){return"width"},fe=".height",de={type:"literal",value:".height",description:'".height"'},ve=function(){return"height"},ge=".centerX",Ae={type:"literal",value:".centerX",description:'".centerX"'},we=function(){return"centerX"},_e=".centerY",ye={type:"literal",value:".centerY",description:'".centerY"'},be=function(){return"centerY"},Ce="/",Ee={type:"literal",value:"/",description:'"/"'},Ie=function(t){return 1/t},Te="/+",Ve={type:"literal",value:"/+",description:'"/+"'},me="/-",He={type:"literal",value:"/-",description:'"/-"'},Oe=function(t){return-1/t},xe="*",Se={type:"literal",value:"*",description:'"*"'},y=function(t){return t},Re="*+",Fe={type:"literal",value:"*+",description:'"*+"'},Ne="*-",Le={type:"literal",value:"*-",description:'"*-"'},ke=function(t){return-t},b=/^[a-zA-Z_]/,C={type:"class",value:"[a-zA-Z_]",description:"[a-zA-Z_]"},E=/^[a-zA-Z0-9_]/,I={type:"class",value:"[a-zA-Z0-9_]",description:"[a-zA-Z0-9_]"},Ze=function(t,e){return{view:t+e,$parserOffset:V}},qe="..",De={type:"literal",value:"..",description:'".."'},ze=function(t){return parseInt(t)},Ge=".",Xe={type:"literal",value:".",description:'"."'},We=function(t,e){return parseFloat(t.concat(".").concat(e).join(""),10)},Pe=function(t){return parseInt(t.join(""),10)},T=0,V=0,m=0,H={line:1,column:1,seenCR:!1},r=0,i=[];if("startRule"in t){if(!(t.startRule in e))throw new Error("Can't start parsing from rule \""+t.startRule+'".');Y=e[t.startRule]}function Ue(t){if(m!==t){t<m&&(m=0,H={line:1,column:1,seenCR:!1});for(var e,r=H,i=t,n=m;n<i;n++)"\n"===(e=u.charAt(n))?(r.seenCR||r.line++,r.column=1,r.seenCR=!1):"\r"===e||"\u2028"===e||"\u2029"===e?(r.line++,r.column=1,r.seenCR=!0):(r.column++,r.seenCR=!1);m=t}return H}function O(t){T<r||(r<T&&(r=T,i=[]),i.push(t))}function Qe(t,e,r){var i=Ue(r),n=r<u.length?u.charAt(r):null;if(null!==e){var a=e,s=1;for(a.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});s<a.length;)a[s-1]===a[s]?a.splice(s,1):s++}return new ar(null!==t?t:function(t,e){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=t[i].description;function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}return"Expected "+(1<t.length?r.slice(0,-1).join(", ")+" or "+r[t.length-1]:r[0])+" but "+(e?'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+n(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+n(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+n(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+n(t)})+'"':"end of input")+" found."}(e,n),e,n,r,i.line,i.column)}function Be(){var t=function(){var t,e,r,i,n,a,s,o;e=t=T,e=(r=function(){var t,e;t=T,u.substr(T,2)===nt?(e=nt,T+=2):(e=l,O(at));e!==l&&(V=t,e=Z());(t=e)===l&&(t=T,72===u.charCodeAt(T)?(e=st,T++):(e=l,O(ot)),e!==l&&(V=t,e=q()),(t=e)===l)&&(t=T,86===u.charCodeAt(T)?(e=ut,T++):(e=l,O(lt)),e!==l&&(V=t,e=D()),(t=e)===l)&&(t=T,90===u.charCodeAt(T)?(e=ct,T++):(e=l,O(ht)),e!==l&&(V=t,e=z()),t=e);return t}())!==l&&(58===u.charCodeAt(T)?(i=et,T++):(i=l,O(rt)),i!==l)?r=[r,i]:(T=e,c);e===l&&(e=h);if(e!==l)if(r=T,i=je(),(r=(r=i!==l&&(n=F())!==l?i=[i,n]:(T=r,c))===l?h:r)!==l)if((i=S())!==l){for(n=[],a=T,s=F(),a=s!==l&&(o=S())!==l?s=[s,o]:(T=a,c);a!==l;)n.push(a),a=T,s=F(),a=s!==l&&(o=S())!==l?s=[s,o]:(T=a,c);t=n!==l&&(a=T,s=F(),(a=(a=s!==l&&(o=je())!==l?s=[s,o]:(T=a,c))===l?h:a)!==l)&&(s=(s=$e())===l?h:s)!==l?(V=t,e=it(e,r,i,n,a)):(T=t,c)}else T=t,t=c;else T=t,t=c;else T=t,t=c;return t}();return t=t===l?function(){var t,e,r,i,n,a;t=T,u.substr(T,2)===J?(e=J,T+=2):(e=l,O(K));if(e!==l)if((r=nr())!==l)if((i=x())!==l){for(n=[],a=x();a!==l;)n.push(a),a=x();t=n!==l&&(a=(a=$e())===l?h:a)!==l?(V=t,e=tt(r,i,n)):(T=t,c)}else T=t,t=c;else T=t,t=c;else T=t,t=c;return t}():t}function x(){var t,e=T,r=ir();return e=r!==l&&(t=Me())!==l?(V=e,k(r,t)):(T=e,c)}function $e(){var t,e,r,i=T,n=[];for(32===u.charCodeAt(T)?(t=pt,T++):(t=l,O(ft));t!==l;)n.push(t),32===u.charCodeAt(T)?(t=pt,T++):(t=l,O(ft));if(n!==l)if(u.substr(T,2)===dt?(t=dt,T+=2):(t=l,O(vt)),t!==l){for(e=[],u.length>T?(r=u.charAt(T),T++):(r=l,O(gt));r!==l;)e.push(r),u.length>T?(r=u.charAt(T),T++):(r=l,O(gt));i=e!==l?n=[n,t,e]:(T=i,c)}else T=i,i=c;else T=i,i=c;return i}function je(){var t,e=T;return 124===u.charCodeAt(T)?(t=At,T++):(t=l,O(wt)),t!==l&&(V=e,t=G()),t}function S(){var t,e,r,i,n,a,s=T;if(91===u.charCodeAt(T)?(t=_t,T++):(t=l,O(yt)),t!==l)if((e=R())!==l){for(r=[],i=T,44===u.charCodeAt(T)?(n=o,T++):(n=l,O(p)),i=n!==l&&(a=R())!==l?n=[n,a]:(T=i,c);i!==l;)r.push(i),i=T,44===u.charCodeAt(T)?(n=o,T++):(n=l,O(p)),i=n!==l&&(a=R())!==l?n=[n,a]:(T=i,c);s=r!==l&&(93===u.charCodeAt(T)?(i=bt,T++):(i=l,O(Ct)),i!==l)?(V=s,t=X(e,r)):(T=s,c)}else T=s,s=c;else T=s,s=c;return s}function R(){var t,e,r=T,i=function(){var t,e,r,i,n;e=t=T,r=[],b.test(u.charAt(T))?(i=u.charAt(T),T++):(i=l,O(C));if(i!==l)for(;i!==l;)r.push(i),b.test(u.charAt(T))?(i=u.charAt(T),T++):(i=l,O(C));else r=c;r!==l&&(r=u.substring(e,T));if((e=r)!==l){for(r=T,i=[],E.test(u.charAt(T))?(n=u.charAt(T),T++):(n=l,O(I));n!==l;)i.push(n),E.test(u.charAt(T))?(n=u.charAt(T),T++):(n=l,O(I));i!==l&&(i=u.substring(r,T)),t=(r=i)!==l&&(i=function(){var t,e,r,i;t=T,u.substr(T,2)===qe?(e=qe,T+=2):(e=l,O(De));if(e!==l){if(r=[],d.test(u.charAt(T))?(i=u.charAt(T),T++):(i=l,O(v)),i!==l)for(;i!==l;)r.push(i),d.test(u.charAt(T))?(i=u.charAt(T),T++):(i=l,O(v));else r=c;t=r!==l?(V=t,e=ze(r)):(T=t,c)}else T=t,t=c;return t}())!==l?(V=t,e=M(e,r,i)):(T=t,c)}else T=t,t=c;if(t===l){if(e=t=T,r=[],b.test(u.charAt(T))?(i=u.charAt(T),T++):(i=l,O(C)),i!==l)for(;i!==l;)r.push(i),b.test(u.charAt(T))?(i=u.charAt(T),T++):(i=l,O(C));else r=c;if(r!==l&&(r=u.substring(e,T)),(e=r)!==l){for(r=T,i=[],E.test(u.charAt(T))?(n=u.charAt(T),T++):(n=l,O(I));n!==l;)i.push(n),E.test(u.charAt(T))?(n=u.charAt(T),T++):(n=l,O(I));i!==l&&(i=u.substring(r,T)),t=(r=i)!==l?(V=t,e=Ze(e,r)):(T=t,c)}else T=t,t=c}return t}();return r=i!==l&&(t=(t=Me())===l?h:t)!==l&&(e=(e=function(){var t,e,r,i,n,a;t=T,58===u.charCodeAt(T)?(e=et,T++):(e=l,O(rt));if(e!==l){if(r=[],i=T,n=F(),(i=n!==l&&(a=S())!==l?n=[n,a]:(T=i,c))!==l)for(;i!==l;)r.push(i),i=T,n=F(),i=n!==l&&(a=S())!==l?n=[n,a]:(T=i,c);else r=c;t=r!==l&&(i=F())!==l?(V=t,e=W(r,i)):(T=t,c)}else T=t,t=c;return t}())===l?h:e)!==l?(V=r,Et(i,t,e)):(T=r,c)}function F(){var t,e,r,i=T;return u.substr(T,2)===It?(t=It,T+=2):(t=l,O(Tt)),t!==l&&(V=i,t=Vt()),(i=t)===l&&(i=T,45===u.charCodeAt(T)?(t=a,T++):(t=l,O(s)),(i=t!==l&&(e=function(){var t;(t=function(){var t,e;t=T,(e=rr())!==l&&(V=t,e=Rt(e));(t=e)===l&&(t=T,(e=N())!==l&&(V=t,e=Ft(e)),t=e);return t}())===l&&(t=Me());return t}())!==l&&(45===u.charCodeAt(T)?(r=a,T++):(r=l,O(s)),r!==l)?(V=i,t=mt(e)):(T=i,c))===l)&&(i=T,45===u.charCodeAt(T)?(t=a,T++):(t=l,O(s)),t!==l&&(V=i,t=Ht()),(i=t)===l)&&(i=T,126===u.charCodeAt(T)?(t=n,T++):(t=l,O(f)),(i=t!==l&&(e=function(){var t,e,r,i,n,a,s;t=T,40===u.charCodeAt(T)?(e=Nt,T++):(e=l,O(Lt));if(e!==l)if((r=Je())!==l){for(i=[],n=T,44===u.charCodeAt(T)?(a=o,T++):(a=l,O(p)),n=a!==l&&(s=Je())!==l?a=[a,s]:(T=n,c);n!==l;)i.push(n),n=T,44===u.charCodeAt(T)?(a=o,T++):(a=l,O(p)),n=a!==l&&(s=Je())!==l?a=[a,s]:(T=n,c);t=i!==l&&(41===u.charCodeAt(T)?(n=kt,T++):(n=l,O(Zt)),n!==l)?(V=t,e=qt(r,i)):(T=t,c)}else T=t,t=c;else T=t,t=c;return t}())!==l&&(126===u.charCodeAt(T)?(r=n,T++):(r=l,O(f)),r!==l)?(V=i,t=mt(e)):(T=i,c))===l)&&(i=T,126===u.charCodeAt(T)?(t=n,T++):(t=l,O(f)),t!==l&&(V=i,t=Ot()),(i=t)===l)&&(i=T,(t=xt)!==l&&(V=i,t=St()),i=t),i}function Me(){var t,e,r,i,n,a,s=T;if(40===u.charCodeAt(T)?(t=Nt,T++):(t=l,O(Lt)),t!==l)if((e=Ye())!==l){for(r=[],i=T,44===u.charCodeAt(T)?(n=o,T++):(n=l,O(p)),i=n!==l&&(a=Ye())!==l?n=[n,a]:(T=i,c);i!==l;)r.push(i),i=T,44===u.charCodeAt(T)?(n=o,T++):(n=l,O(p)),i=n!==l&&(a=Ye())!==l?n=[n,a]:(T=i,c);s=r!==l&&(41===u.charCodeAt(T)?(i=kt,T++):(i=l,O(Zt)),i!==l)?(V=s,t=qt(e,r)):(T=s,c)}else T=s,s=c;else T=s,s=c;return s}function Ye(){var t,e,r,i,n=T,a=Ke();return n=(a=a===l?h:a)!==l&&(t=tr())!==l&&(e=T,64===u.charCodeAt(T)?(r=Dt,T++):(r=l,O(zt)),(e=(e=r!==l&&(i=er())!==l?r=[r,i]:(T=e,c))===l?h:e)!==l)?(V=n,a=P(a,t,e)):(T=n,c)}function Je(){var t,e,r,i,n=T,a=Ke();return n=(a=a===l?h:a)!==l&&(t=tr())!==l&&(e=T,64===u.charCodeAt(T)?(r=Dt,T++):(r=l,O(zt)),(e=(e=r!==l&&(i=er())!==l?r=[r,i]:(T=e,c))===l?h:e)!==l)?(V=n,a=Gt(a,t,e)):(T=n,c)}function Ke(){var t,e=T;return u.substr(T,2)===Xt?(t=Xt,T+=2):(t=l,O(Wt)),t!==l&&(V=e,t=Pt()),(e=t)===l&&(e=T,u.substr(T,2)===Ut?(t=Ut,T+=2):(t=l,O(Qt)),t!==l&&(V=e,t=Bt()),(e=t)===l)&&(e=T,u.substr(T,2)===$t?(t=$t,T+=2):(t=l,O(jt)),t!==l&&(V=e,t=Mt()),e=t),e}function tr(){var t=rr();return t=t===l&&(t=function(){var t,e,r;t=T,(e=N())!==l&&(V=t,e=U(e));(t=e)===l&&(t=T,45===u.charCodeAt(T)?(e=a,T++):(e=l,O(s)),(t=e!==l&&(r=N())!==l?(V=t,e=Q(r)):(T=t,c))===l)&&(t=T,43===u.charCodeAt(T)?(e=g,T++):(e=l,O(A)),t=e!==l&&(r=N())!==l?(V=t,e=U(r)):(T=t,c));return t}())===l?function(){var t,e,r,i,n;t=T,t=(e=nr())!==l&&(r=ir(),(r=r===l?h:r)!==l)&&(i=(i=function(){var t,e,r;t=T,47===u.charCodeAt(T)?(e=Ce,T++):(e=l,O(Ee));t=e!==l&&(r=N(),r!==l)?(V=t,e=Ie(r)):(T=t,c);t===l&&(t=T,u.substr(T,2)===Te?(e=Te,T+=2):(e=l,O(Ve)),(t=e!==l&&(r=N())!==l?(V=t,e=Ie(r)):(T=t,c))===l)&&(t=T,u.substr(T,2)===me?(e=me,T+=2):(e=l,O(He)),(t=e!==l&&(r=N())!==l?(V=t,e=Oe(r)):(T=t,c))===l)&&(t=T,42===u.charCodeAt(T)?(e=xe,T++):(e=l,O(Se)),(t=e!==l&&(r=N())!==l?(V=t,e=y(r)):(T=t,c))===l)&&(t=T,u.substr(T,2)===Re?(e=Re,T+=2):(e=l,O(Fe)),(t=e!==l&&(r=N())!==l?(V=t,e=y(r)):(T=t,c))===l)&&(t=T,u.substr(T,2)===Ne?(e=Ne,T+=2):(e=l,O(Le)),t=e!==l&&(r=N())!==l?(V=t,e=ke(r)):(T=t,c));return t}())===l?h:i)!==l&&(n=(n=function(){var t,e,r;t=T,45===u.charCodeAt(T)?(e=a,T++):(e=l,O(s));t=e!==l&&(r=N(),r!==l)?(V=t,e=ke(r)):(T=t,c);t===l&&(t=T,43===u.charCodeAt(T)?(e=g,T++):(e=l,O(A)),t=e!==l&&(r=N())!==l?(V=t,e=y(r)):(T=t,c));return t}())===l?h:n)!==l?(V=t,e=j(e,r,i,n)):(T=t,c);return t}():t}function er(){var t,e=T,r=[];if(d.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(v)),t!==l)for(;t!==l;)r.push(t),d.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(v));else r=c;return r!==l&&(V=e,r=Yt(r)),r}function rr(){var t,e,r=T,i=N();return(r=i!==l&&(37===u.charCodeAt(T)?(t=w,T++):(t=l,O(_)),t!==l)?(V=r,i=B(i)):(T=r,c))===l&&(r=T,45===u.charCodeAt(T)?(i=a,T++):(i=l,O(s)),(r=i!==l&&(t=N())!==l&&(37===u.charCodeAt(T)?(e=w,T++):(e=l,O(_)),e!==l)?(V=r,i=$(t)):(T=r,c))===l)&&(r=T,43===u.charCodeAt(T)?(i=g,T++):(i=l,O(A)),r=i!==l&&(t=N())!==l&&(37===u.charCodeAt(T)?(e=w,T++):(e=l,O(_)),e!==l)?(V=r,i=B(t)):(T=r,c)),r}function ir(){var t,e=T;return u.substr(T,5)===Jt?(t=Jt,T+=5):(t=l,O(Kt)),t!==l&&(V=e,t=te()),(e=t)===l&&(e=T,u.substr(T,6)===ee?(t=ee,T+=6):(t=l,O(re)),t!==l&&(V=e,t=ie()),(e=t)===l)&&(e=T,u.substr(T,4)===ne?(t=ne,T+=4):(t=l,O(ae)),t!==l&&(V=e,t=se()),(e=t)===l)&&(e=T,u.substr(T,7)===oe?(t=oe,T+=7):(t=l,O(ue)),t!==l&&(V=e,t=le()),(e=t)===l)&&(e=T,u.substr(T,6)===ce?(t=ce,T+=6):(t=l,O(he)),t!==l&&(V=e,t=pe()),(e=t)===l)&&(e=T,u.substr(T,7)===fe?(t=fe,T+=7):(t=l,O(de)),t!==l&&(V=e,t=ve()),(e=t)===l)&&(e=T,u.substr(T,8)===ge?(t=ge,T+=8):(t=l,O(Ae)),t!==l&&(V=e,t=we()),(e=t)===l)&&(e=T,u.substr(T,8)===_e?(t=_e,T+=8):(t=l,O(ye)),t!==l&&(V=e,t=be()),e=t),e}function nr(){var t,e,r=T,i=T,n=[];if(b.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(C)),t!==l)for(;t!==l;)n.push(t),b.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(C));else n=c;if((i=n=n!==l?u.substring(i,T):n)!==l){for(n=T,t=[],E.test(u.charAt(T))?(e=u.charAt(T),T++):(e=l,O(I));e!==l;)t.push(e),E.test(u.charAt(T))?(e=u.charAt(T),T++):(e=l,O(I));r=(n=t=t!==l?u.substring(n,T):t)!==l?(V=r,i=Ze(i,n)):(T=r,c)}else T=r,r=c;return r}function N(){var t,e,r,i=T,n=[];if(d.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(v)),t!==l)for(;t!==l;)n.push(t),d.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(v));else n=c;if(n!==l)if(46===u.charCodeAt(T)?(t=Ge,T++):(t=l,O(Xe)),t!==l){if(e=[],d.test(u.charAt(T))?(r=u.charAt(T),T++):(r=l,O(v)),r!==l)for(;r!==l;)e.push(r),d.test(u.charAt(T))?(r=u.charAt(T),T++):(r=l,O(v));else e=c;i=e!==l?(V=i,n=We(n,e)):(T=i,c)}else T=i,i=c;else T=i,i=c;if(i===l){if(i=T,n=[],d.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(v)),t!==l)for(;t!==l;)n.push(t),d.test(u.charAt(T))?(t=u.charAt(T),T++):(t=l,O(v));else n=c;n!==l&&(V=i,n=Pe(n)),i=n}return i}function L(t){for(var e=1;e<arguments.length;e++)for(var r in arguments[e])t[r]=arguments[e][r];return t}if((e=Y())!==l&&T===u.length)return e;throw e!==l&&T<u.length&&O({type:"end",description:"end of input"}),Qe(null,i,r)}};function ar(t,e,r,i,n,a){this.message=t,this.expected=e,this.found=r,this.offset=i,this.line=n,this.column=a,this.name="SyntaxError"}function a(){this.constructor=n}const x={HORIZONTAL:1,VERTICAL:2,ZINDEX:4};function S(t,e,r){let i;for(var n=1;n<=4;n*=2)if(r.orientations&n&&r.stack.orientation!==n&&!(r.stack.processedOrientations&n)){r.stack.processedOrientations=r.stack.processedOrientations|n,i=i||{name:e,type:"stack"};for(var a=0,s=r.stack.subViews.length;a<s;a++)n===x.ZINDEX?t.constraints.push({view1:i,attr1:H.ZINDEX,relation:O.EQU,view2:r.stack.subViews[a],attr2:H.ZINDEX}):(t.constraints.push({view1:i,attr1:n===x.VERTICAL?H.HEIGHT:H.WIDTH,relation:O.EQU,view2:r.stack.subViews[a],attr2:n===x.VERTICAL?H.HEIGHT:H.WIDTH}),t.constraints.push({view1:i,attr1:n===x.VERTICAL?H.TOP:H.LEFT,relation:O.EQU,view2:r.stack.subViews[a],attr2:n===x.VERTICAL?H.TOP:H.LEFT}))}}function R(t,e){if(!0===e&&(e=t.match(/\.\.\d+$/))&&(t=t.substring(0,t.length-e[0].length),e=parseInt(e[0].substring(2))),!e)return[t];var r,i=t.match(/\d+$/),n=[];if(i)for(t=t.substring(0,t.length-i[0].length),r=parseInt(i);r<=e;r++)n.push(t+r);else for(n.push(t),r=2;r<=e;r++)n.push(t+r);return n}function F(e,r,t){var i=t?t.view:null,n=[];let a=[],s;i&&(r.push({view:i}),a.push(i));for(var o,u=0;u<r.length;u++){let t=r[u];if(!Array.isArray(t)&&t.hasOwnProperty("view")||Array.isArray(t)&&t[0].view&&!t[0].relation)for(var l=Array.isArray(t)?t:[t],c=0;c<l.length;c++)for(var h=","===(t=l[c])?[]:t.view?R(t.view,t.range):[null],p=0;p<h.length;p++){var f=h[p];if(a.push(f),f!==i&&(n.push(f),(s=e.subViews[f])||(s={orientations:0},e.subViews[f]=s),s.orientations=s.orientations|e.orientation,s.stack)&&S(e,f,s),void 0!==e.prevViews&&void 0!==f&&e.relation&&"none"!==e.relation.relation)for(var d=0;d<e.prevViews.length;d++){var v=e.prevViews[d];switch(e.orientation){case x.HORIZONTAL:e.prevAttr=v!==i?H.RIGHT:H.LEFT,e.curAttr=f!==i?H.LEFT:H.RIGHT;break;case x.VERTICAL:e.prevAttr=v!==i?H.BOTTOM:H.TOP,e.curAttr=f!==i?H.TOP:H.BOTTOM;break;case x.ZINDEX:e.prevAttr=H.ZINDEX,e.curAttr=H.ZINDEX,e.relation.constant=v?e.relation.constant||"default":0}e.constraints.push({view1:v,attr1:e.prevAttr,relation:e.relation.relation,view2:f,attr2:e.curAttr,multiplier:e.relation.multiplier,constant:"default"!==e.relation.constant&&e.relation.constant?-e.relation.constant:e.relation.constant,priority:e.relation.priority})}var g=t.constraints;if(g)for(var A=0;A<g.length;A++)e.prevAttr=e.horizontal?H.WIDTH:H.HEIGHT,e.curAttr=g[A].view||g[A].multiplier?g[A].attribute||e.prevAttr:g[A].variable?H.VARIABLE:H.CONST,e.constraints.push({view1:f,attr1:e.prevAttr,relation:g[A].relation,view2:g[A].view,attr2:e.curAttr,multiplier:g[A].multiplier,constant:g[A].constant,priority:g[A].priority});t.cascade&&F(e,t.cascade,t)}else if(","!==t&&(e.prevViews=a,a=[],e.relation=t[0],void 0!==e.prevViews)){if(e.relation.equalSpacing){C=b=y=_=w=void 0;var w=e,_=i,y=(w.equalSpacerIndex=w.equalSpacerIndex||1,"_~"+w.lineIndex+":"+w.equalSpacerIndex+"~");1<w.equalSpacerIndex&&w.constraints.push({view1:"_~"+w.lineIndex+":1~",attr1:w.horizontal?H.WIDTH:H.HEIGHT,relation:w.relation.relation||O.EQU,view2:y,attr2:w.horizontal?H.WIDTH:H.HEIGHT,priority:w.relation.priority}),w.equalSpacerIndex++,w.relation.view||w.relation.multiplier&&1!==w.relation.multiplier?(w.constraints.push({view1:y,attr1:w.horizontal?H.WIDTH:H.HEIGHT,relation:w.relation.relation||O.EQU,view2:w.relation.view,attr2:w.horizontal?H.WIDTH:H.HEIGHT,priority:w.relation.priority,multiplier:w.relation.multiplier}),w.relation.multiplier=void 0):w.relation.constant&&(w.constraints.push({view1:y,attr1:w.horizontal?H.WIDTH:H.HEIGHT,relation:O.EQU,view2:null,attr2:H.CONST,priority:w.relation.priority,constant:w.relation.constant}),w.relation.constant=void 0);for(var b=0;b<w.prevViews.length;b++){var C=w.prevViews[b];switch(w.orientation){case x.HORIZONTAL:w.prevAttr=C!==_?H.RIGHT:H.LEFT,w.curAttr=H.LEFT;break;case x.VERTICAL:w.prevAttr=C!==_?H.BOTTOM:H.TOP,w.curAttr=H.TOP;break;case x.ZINDEX:w.prevAttr=H.ZINDEX,w.curAttr=H.ZINDEX,w.relation.constant=C!==_?"default":0}w.constraints.push({view1:C,attr1:w.prevAttr,relation:w.relation.relation,view2:y,attr2:w.curAttr,priority:w.relation.priority})}w.prevViews=[y]}if(e.relation.multiplier){m=V=T=I=E=void 0;var E=e,I=i,T=(E.proportionalSpacerIndex=E.proportionalSpacerIndex||1,"_-"+E.lineIndex+":"+E.proportionalSpacerIndex+"-");E.proportionalSpacerIndex++,E.constraints.push({view1:T,attr1:E.horizontal?H.WIDTH:H.HEIGHT,relation:E.relation.relation||O.EQU,view2:E.relation.view,attr2:E.horizontal?H.WIDTH:H.HEIGHT,priority:E.relation.priority,multiplier:E.relation.multiplier}),E.relation.multiplier=void 0;for(var V=0;V<E.prevViews.length;V++){var m=E.prevViews[V];switch(E.orientation){case x.HORIZONTAL:E.prevAttr=m!==I?H.RIGHT:H.LEFT,E.curAttr=H.LEFT;break;case x.VERTICAL:E.prevAttr=m!==I?H.BOTTOM:H.TOP,E.curAttr=H.TOP;break;case x.ZINDEX:E.prevAttr=H.ZINDEX,E.curAttr=H.ZINDEX,E.relation.constant=m!==I?"default":0}E.constraints.push({view1:m,attr1:E.prevAttr,relation:E.relation.relation,view2:T,attr2:E.curAttr,priority:E.relation.priority})}E.prevViews=[T]}}}if(i){if(s=e.subViews[i]){if(s.stack)throw(o=new Error('A stack named "'+i+'" has already been created')).column=t.$parserOffset+1,o}else s={orientations:e.orientation},e.subViews[i]=s;s.stack={orientation:e.orientation,processedOrientations:e.orientation,subViews:n},S(e,i,s)}}const T=["viewport","spacing","colors","shapes","widths","heights"];class l{static parseLine(t,e){if(0===t.length||e&&e.extended&&0===t.indexOf("//"))return[];var r=(e&&e.extended?u:s).parse(t);if(e&&"raw"===e.outFormat)return[r];let i={constraints:[],lineIndex:(e?e.lineIndex:void 0)||1,subViews:(e?e.subViews:void 0)||{}};if("attribute"===r.type)for(let t=0;t<r.attributes.length;t++){var n=r.attributes[t];for(let t=0;t<n.predicates.length;t++){var a=n.predicates[t];i.constraints.push({view1:r.view,attr1:n.attr,relation:a.relation,view2:a.view,attr2:a.attribute||n.attr,multiplier:a.multiplier,constant:a.constant,priority:a.priority})}}else switch(r.orientation){case"horizontal":i.orientation=x.HORIZONTAL,i.horizontal=!0,F(i,r.cascade,null);break;case"vertical":i.orientation=x.VERTICAL,F(i,r.cascade,null);break;case"horzvert":i.orientation=x.HORIZONTAL,i.horizontal=!0,F(i,r.cascade,null),F(i={constraints:i.constraints,lineIndex:i.lineIndex,subViews:i.subViews,orientation:x.VERTICAL},r.cascade,null);break;case"zIndex":i.orientation=x.ZINDEX,F(i,r.cascade,null)}return i.constraints}static parse(e,t){var r=t&&t.lineSeparator?t.lineSeparator:"\n";if(!Array.isArray(e)&&e.indexOf(r)<0)try{return this.parseLine(e,t)}catch(t){throw t.source=e,t}e=Array.isArray(e)?e:[e];let i=[],n=0,a;var s={lineIndex:n,extended:t&&t.extended,strict:!t||void 0===t.strict||t.strict,outFormat:t?t.outFormat:void 0,subViews:{}};try{for(var o=0;o<e.length;o++)for(var u=e[o].split(r),l=0;l<u.length;l++)a=u[l],n++,s.lineIndex=n,s.strict||(a=a.trim()),(s.strict||a.length)&&(i=i.concat(this.parseLine(a,s)))}catch(t){throw t.source=a,t.line=n,t}return i}static parseMetaInfo(t,e){for(var r,i,n=e&&e.lineSeparator?e.lineSeparator:"\n",a=e?e.prefix:void 0,s=(t=Array.isArray(t)?t:[t],{}),o=0;o<t.length;o++)for(var u=t[o].split(n),l=0;l<u.length;l++)for(var c=u[l],h=0;h<T.length;h++)for(var p=0;p<(a?2:1);p++){var f=T[h],d=(0===p?"":a)+f;if(0===c.indexOf("//"+d+" "))for(var v=c.substring(3+d.length).split(" "),g=0;g<v.length;g++){s[f]=s[f]||{};for(var A=v[g].split(":"),w=R(A[0],!0),_=0;_<w.length;_++)s[f][w[_]]=1<A.length?A[1]:""}else 0===c.indexOf("//"+d+":")&&(s[f]=c.substring(3+d.length))}if(s.viewport&&((i=(e=s.viewport)["aspect-ratio"])&&(i=i.split("/"),e["aspect-ratio"]=parseInt(i[0])/parseInt(i[1])),void 0!==e.height&&(e.height="intrinsic"===e.height||parseInt(e.height)),void 0!==e.width&&(e.width="intrinsic"===e.width||parseInt(e.width)),void 0!==e["max-height"]&&(e["max-height"]=parseInt(e["max-height"])),void 0!==e["max-width"]&&(e["max-width"]=parseInt(e["max-width"])),void 0!==e["min-height"]&&(e["min-height"]=parseInt(e["min-height"])),void 0!==e["min-width"])&&(e["min-width"]=parseInt(e["min-width"])),s.widths)for(r in s.widths){var y="intrinsic"===s.widths[r]||parseInt(s.widths[r]);void 0!==(s.widths[r]=y)&&!isNaN(y)||delete s.widths[r]}if(s.heights)for(r in s.heights){var b="intrinsic"===s.heights[r]||parseInt(s.heights[r]);void 0!==(s.heights[r]=b)&&!isNaN(b)||delete s.heights[r]}if(s.spacing){var C=JSON.parse(s.spacing);if(s.spacing=C,Array.isArray(C)){for(var E=0,I=C.length;E<I;E++)if(isNaN(C[E])){delete s.spacing;break}}else void 0!==C&&!isNaN(C)||delete s.spacing}return s}}class c{constructor(t){this._name=t.name,this._type=t.type,this._solver=t.solver,this._attr={},t.name||(this._attr[H.LEFT]=new o.Variable,this._solver.addConstraint(new o.Constraint(this._attr[H.LEFT],o.Operator.Eq,0)),this._attr[H.TOP]=new o.Variable,this._solver.addConstraint(new o.Constraint(this._attr[H.TOP],o.Operator.Eq,0)),this._attr[H.ZINDEX]=new o.Variable,this._solver.addConstraint(new o.Constraint(this._attr[H.ZINDEX],o.Operator.Eq,0)))}toJSON(){return{name:this.name,left:this.left,top:this.top,width:this.width,height:this.height}}toString(){JSON.stringify(this.toJSON(),void 0,2)}get name(){return this._name}get left(){return this._getAttrValue(H.LEFT)}get right(){return this._getAttrValue(H.RIGHT)}get width(){return this._getAttrValue(H.WIDTH)}get height(){return this._getAttrValue(H.HEIGHT)}get intrinsicWidth(){return this._intrinsicWidth}set intrinsicWidth(t){var e;void 0!==t&&t!==this._intrinsicWidth&&(e=this._getAttr(H.WIDTH),void 0===this._intrinsicWidth&&this._solver.addEditVariable(e,o.Strength.create(this._name?998:999,1e3,1e3)),this._intrinsicWidth=t,this._solver.suggestValue(e,t),this._solver.updateVariables())}get intrinsicHeight(){return this._intrinsicHeight}set intrinsicHeight(t){var e;void 0!==t&&t!==this._intrinsicHeight&&(e=this._getAttr(H.HEIGHT),void 0===this._intrinsicHeight&&this._solver.addEditVariable(e,o.Strength.create(this._name?998:999,1e3,1e3)),this._intrinsicHeight=t,this._solver.suggestValue(e,t),this._solver.updateVariables())}get top(){return this._getAttrValue(H.TOP)}get bottom(){return this._getAttrValue(H.BOTTOM)}get centerX(){return this._getAttrValue(H.CENTERX)}get centerY(){return this._getAttrValue(H.CENTERY)}get zIndex(){return this._getAttrValue(H.ZINDEX)}get type(){return this._type}getValue(t){return this._attr[t]?this._attr[t].value():void 0}_getAttr(t){if(!this._attr[t]){switch(this._attr[t]=new o.Variable,t){case H.RIGHT:this._getAttr(H.LEFT),this._getAttr(H.WIDTH),this._solver.addConstraint(new o.Constraint(this._attr[t],o.Operator.Eq,this._attr[H.LEFT].plus(this._attr[H.WIDTH])));break;case H.BOTTOM:this._getAttr(H.TOP),this._getAttr(H.HEIGHT),this._solver.addConstraint(new o.Constraint(this._attr[t],o.Operator.Eq,this._attr[H.TOP].plus(this._attr[H.HEIGHT])));break;case H.CENTERX:this._getAttr(H.LEFT),this._getAttr(H.WIDTH),this._solver.addConstraint(new o.Constraint(this._attr[t],o.Operator.Eq,this._attr[H.LEFT].plus(this._attr[H.WIDTH].divide(2))));break;case H.CENTERY:this._getAttr(H.TOP),this._getAttr(H.HEIGHT),this._solver.addConstraint(new o.Constraint(this._attr[t],o.Operator.Eq,this._attr[H.TOP].plus(this._attr[H.HEIGHT].divide(2))))}this._solver.updateVariables()}return this._attr[t]}_getAttrValue(t){return this._getAttr(t).value()}}const h=o.Strength.create(0,1e3,1e3);class p{constructor(t){this._solver=new o.Solver,this._subViews={},this._parentSubView=new c({solver:this._solver}),this.setSpacing(t&&void 0!==t.spacing?t.spacing:8),t&&(void 0===t.width&&void 0===t.height||this.setSize(t.width,t.height),t.constraints)&&this.addConstraints(t.constraints)}setSize(t,e){return this._parentSubView.intrinsicWidth=t,this._parentSubView.intrinsicHeight=e,this}get width(){return this._parentSubView.intrinsicWidth}get height(){return this._parentSubView.intrinsicHeight}get fittingWidth(){return this._parentSubView.width}get fittingHeight(){return this._parentSubView.height}setSpacing(t){if(Array.isArray(t))switch(t.length){case 1:t=[t[0],t[0],t[0],t[0],t[0],t[0],1];break;case 2:t=[t[1],t[0],t[1],t[0],t[0],t[1],1];break;case 3:t=[t[1],t[0],t[1],t[0],t[0],t[1],t[2]];break;case 6:t=[t[0],t[1],t[2],t[3],t[4],t[5],1];break;case 7:break;default:throw"Invalid spacing syntax"}else t=[t,t,t,t,t,t,1];if(!this._compareSpacing(this._spacing,t)&&(this._spacing=t,this._spacingVars)){for(var e=0;e<this._spacingVars.length;e++)this._spacingVars[e]&&this._solver.suggestValue(this._spacingVars[e],this._spacing[e]);this._solver.updateVariables()}return this}_compareSpacing(t,e){if(t!==e){if(!t||!e)return!1;for(var r=0;r<7;r++)if(t[r]!==e[r])return!1}return!0}addConstraint(t){return this._addConstraint(t),this._solver.updateVariables(),this}addConstraints(t){for(var e=0;e<t.length;e++)this._addConstraint(t[e]);return this._solver.updateVariables(),this}_addConstraint(t){let e;var r=void 0!==t.multiplier?t.multiplier:1;let i=void 0!==t.constant?t.constant:0;"default"===i&&(i=this._getSpacing(t));var n=this._getSubView(t.view1)._getAttr(t.attr1);let a;t.attr2===H.CONST?a=this._getConst(void 0,t.constant):(a=this._getSubView(t.view2)._getAttr(t.attr2),1!==r&&i?a=a.multiply(r).plus(i):i?a=a.plus(i):1!==r&&(a=a.multiply(r)));var s=void 0!==t.priority&&t.priority<1e3?o.Strength.create(0,t.priority,1e3):h;switch(t.relation){case O.EQU:e=new o.Constraint(n,o.Operator.Eq,a,s);break;case O.GEQ:e=new o.Constraint(n,o.Operator.Ge,a,s);break;case O.LEQ:e=new o.Constraint(n,o.Operator.Le,a,s);break;default:throw"Invalid relation specified: "+t.relation}this._solver.addConstraint(e)}_getSpacing(t){let e=4;if(t.view1||"left"!==t.attr1)if(t.view1||"top"!==t.attr1)if(t.view2||"right"!==t.attr2)if(t.view2||"bottom"!==t.attr2)switch(t.attr1){case"left":case"right":case"centerX":case"leading":case"trailing":e=4;break;case"zIndex":e=6;break;default:e=5}else e=2;else e=1;else e=0;else e=3;return this._spacingVars=this._spacingVars||new Array(7),this._spacingExpr=this._spacingExpr||new Array(7),this._spacingVars[e]||(this._spacingVars[e]=new o.Variable,this._solver.addEditVariable(this._spacingVars[e],o.Strength.create(999,1e3,1e3)),this._spacingExpr[e]=this._spacingVars[e].multiply(-1),this._solver.suggestValue(this._spacingVars[e],this._spacing[e])),this._spacingExpr[e]}_getSubView(t){return t?t.name?(this._subViews[t.name]=this._subViews[t.name]||new c({name:t.name,solver:this._solver}),this._subViews[t.name]._type=this._subViews[t.name]._type||t.type,this._subViews[t.name]):(this._subViews[t]=this._subViews[t]||new c({name:t,solver:this._solver}),this._subViews[t]):this._parentSubView}_getConst(t,e){var r=new o.Variable;return this._solver.addConstraint(new o.Constraint(r,o.Operator.Eq,e)),r}get subViews(){return this._subViews}}var f={Attribute:H,Relation:O,Priority:r,VisualFormat:l,View:p,SubView:c};t.Attribute=H,t.Priority=r,t.Relation=O,t.SubView=c,t.View=p,t.VisualFormat=l,t.default=f,Object.defineProperty(t,"__esModule",{value:!0})});
